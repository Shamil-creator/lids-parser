# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø: State Machine + Coordinator

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–º–µ–ª–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
- ‚ùå –°–º–µ—à–∏–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π (join, –ø—Ä–æ–≤–µ—Ä–∫–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ)
- ‚ùå In-memory –æ—á–µ—Ä–µ–¥–∏ (–ø–æ—Ç–µ—Ä—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–∞—Ö)
- ‚ùå –ù–µ—á—ë—Ç–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã (PendingJoin/Joined/Inactive –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ—Ç–∞–ª—å–Ω—ã)
- ‚ùå Race conditions –∏ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
- ‚ùå –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (–ª—é–±–∞—è –æ—à–∏–±–∫–∞ ‚Üí –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è)

## –†–µ—à–µ–Ω–∏–µ: State Machine + Coordinator Pattern

### 1. –ß—ë—Ç–∫–∞—è State Machine

–ö–∞–∂–¥–∞—è –ø—Ä–∏–≤–∞—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —è–≤–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

```
NEW ‚Üí ASSIGNED ‚Üí JOIN_QUEUED ‚Üí JOINING ‚Üí JOINED ‚Üí ACTIVE ‚Üí LOST_ACCESS ‚Üí DISABLED
```

#### –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π

| State | –û–ø–∏—Å–∞–Ω–∏–µ | –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ |
|-------|----------|---------------|
| **NEW** | –ì—Ä—É–ø–ø–∞ —Ç–æ–ª—å–∫–æ —á—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞, –µ—â—ë –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω –∞–∫–∫–∞—É–Ω—Ç | Coordinator –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –∞–∫–∫–∞—É–Ω—Ç —Å –Ω–∞–∏–º–µ–Ω—å—à–µ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π |
| **ASSIGNED** | –ê–∫–∫–∞—É–Ω—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω, –≥–æ—Ç–æ–≤–∏–º—Å—è –∫ join | –ü–µ—Ä–µ—Ö–æ–¥ –≤ –æ—á–µ—Ä–µ–¥—å join |
| **JOIN_QUEUED** | –ì—Ä—É–ø–ø–∞ –≤ –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ join, –∂–¥—ë—Ç `next_retry_at` | Join worker –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ |
| **JOINING** | –ü—Ä–æ—Ü–µ—Å—Å join –∑–∞–ø—É—â–µ–Ω (in-flight) | Join —É—Å–ø–µ—à–µ–Ω ‚Üí JOINED, –æ—à–∏–±–∫–∞ ‚Üí retry –∏–ª–∏ DISABLED |
| **JOINED** | Join —É—Å–ø–µ—à–µ–Ω, chat_id —Å–æ—Ö—Ä–∞–Ω—ë–Ω | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ ‚Üí ACTIVE |
| **ACTIVE** | –ì—Ä—É–ø–ø–∞ –∞–∫—Ç–∏–≤–Ω–∞, —Å–ª—É—à–∞–µ–º –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è | –†–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ |
| **LOST_ACCESS** | –ü–æ—Ç–µ—Ä—è–Ω –¥–æ—Å—Ç—É–ø (get_chat failed N —Ä–∞–∑) | –ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–ª–∏ ‚Üí DISABLED |
| **DISABLED** | –ì—Ä—É–ø–ø–∞ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ | –¢–æ–ª—å–∫–æ —Ä—É—á–Ω–∞—è —Ä–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∞–¥–º–∏–Ω–æ–º ‚Üí NEW |

### 2. PrivateGroupCoordinator ‚Äî –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

**–ü—Ä–∏–Ω—Ü–∏–ø:** —Ç–æ–ª—å–∫–æ Coordinator –º–µ–Ω—è–µ—Ç state –≥—Ä—É–ø–ø. –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ‚Äî –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏.

#### Reconcile Pattern

Coordinator —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ **reconcile loop** (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥):
1. –ß–∏—Ç–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ **–∏–∑ –ë–î** (–Ω–µ –∏–∑ –ø–∞–º—è—Ç–∏!)
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω—É–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
3. –ê—Ç–æ–º–∞—Ä–Ω–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≥—Ä—É–ø–ø—ã –≤ —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

```python
async def _reconcile_once(self):
    # NEW ‚Üí ASSIGNED (–Ω–∞–∑–Ω–∞—á–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç)
    await self._process_new_groups()
    
    # ASSIGNED ‚Üí JOIN_QUEUED (–ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫ join)
    await self._process_assigned_groups()
    
    # JOIN_QUEUED ‚Üí JOINING (–≤—ã–ø–æ–ª–Ω–∏—Ç—å join)
    await self._process_join_queued_groups()
    
    # JOINED ‚Üí ACTIVE (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø)
    await self._process_joined_groups()
    
    # ACTIVE: —Ä–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
    await self._process_active_groups()
    
    # LOST_ACCESS ‚Üí DISABLED –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
    await self._process_lost_access_groups()
```

#### –ó–∞—â–∏—Ç–∞ –æ—Ç Race Conditions

–ò—Å–ø–æ–ª—å–∑—É–µ–º **–∞—Ç–æ–º–∞—Ä–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –≤ –ë–î:

```python
def transition_private_group_state(group_id, from_state, to_state, updates):
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ç–µ–∫—É—â–∏–π state == from_state
    # 2. –ï—Å–ª–∏ –¥–∞ ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º –Ω–∞ to_state
    # 3. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –æ—Ç–º–µ–Ω—è–µ–º (–∫—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–π —É–∂–µ –∏–∑–º–µ–Ω–∏–ª)
```

–≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –¥–≤–∞ –≤–æ—Ä–∫–µ—Ä–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø—ã—Ç–∞—é—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å join.

### 3. Retry Logic –≤ –ë–î

**–í–º–µ—Å—Ç–æ in-memory –æ—á–µ—Ä–µ–¥–µ–π** –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª—è –ë–î:

```sql
retry_count INTEGER DEFAULT 0
max_retries INTEGER DEFAULT 5
next_retry_at TIMESTAMP
last_join_attempt_at TIMESTAMP
```

Join worker –±–µ—Ä—ë—Ç –≥—Ä—É–ø–ø—ã –∏–∑ –ë–î:

```sql
SELECT * FROM private_groups
WHERE state = 'JOIN_QUEUED' 
AND (next_retry_at IS NULL OR next_retry_at <= datetime('now'))
```

–ü—Ä–∏ FloodWait:
```python
next_retry = datetime.now() + timedelta(seconds=flood_wait_value + 10)
db.transition_private_group_state(
    group_id, 'JOINING', 'JOIN_QUEUED',
    {'retry_count': retry_count + 1, 'next_retry_at': next_retry}
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–Ω–∞–µ—Ç –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å.

### 4. –ú—è–≥–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞

–í–º–µ—Å—Ç–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–π –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—á—ë—Ç—á–∏–∫ –æ—à–∏–±–æ–∫:

```sql
consecutive_errors INTEGER DEFAULT 0
max_consecutive_errors INTEGER DEFAULT 3
```

–õ–æ–≥–∏–∫–∞:
- get_chat —É—Å–ø–µ—à–µ–Ω ‚Üí `consecutive_errors = 0`
- get_chat failed ‚Üí `consecutive_errors++`
- –ï—Å–ª–∏ `consecutive_errors >= max_consecutive_errors` ‚Üí LOST_ACCESS
- –ï—Å–ª–∏ –≤ LOST_ACCESS get_chat —É—Å–ø–µ—à–µ–Ω ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ ACTIVE
- –ï—Å–ª–∏ –≤ LOST_ACCESS get_chat –≤—Å—ë –µ—â—ë failed ‚Üí DISABLED

–≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –ª–æ–∂–Ω—ã–µ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö Telegram API.

### 5. UserbotManager –∫–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å

UserbotManager **–±–æ–ª—å—à–µ –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç** –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏. –û–Ω —Ç–æ–ª—å–∫–æ:
1. –°–ª—É—à–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ **ACTIVE** –≥—Ä—É–ø–ø
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `last_message_id` (—á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞)
3. –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã (keywords/stopwords)
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ª–∏–¥–∞–º

```python
# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø
if message.chat.type in ("group", "supergroup"):
    group = db.get_private_group_by_chat_id(message.chat.id)
    
    # –¢–æ–ª—å–∫–æ ACTIVE –≥—Ä—É–ø–ø—ã
    if not group or group['state'] != 'ACTIVE':
        return
    
    # –¢–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    if message.id <= group['last_message_id']:
        return
    
    # –û–±–Ω–æ–≤–ª—è–µ–º last_message_id
    db.update_private_group(group['id'], {'last_message_id': message.id})
    
    # –î–∞–ª—å—à–µ –æ–±—ã—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞...
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
# config.py
PRIVATE_GROUP_RECONCILE_INTERVAL = 30  # Reconcile loop –∏–Ω—Ç–µ—Ä–≤–∞–ª (—Å–µ–∫—É–Ω–¥—ã)
PRIVATE_GROUP_JOIN_MIN_DELAY = 120  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ join (—Å–µ–∫—É–Ω–¥—ã)
PRIVATE_GROUP_JOIN_MAX_DELAY = 300  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ join
PRIVATE_GROUP_CHECK_INTERVAL_MINUTES = 30  # –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ ACTIVE –≥—Ä—É–ø–ø–∞–º
MAX_PRIVATE_GROUPS_PER_ACCOUNT = 10  # –ú–∞–∫—Å–∏–º—É–º –≥—Ä—É–ø–ø –Ω–∞ –æ–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç
```

## –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

–ù–æ–≤–∞—è –∞–¥–º–∏–Ω–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º (—Å–∫–æ–ª—å–∫–æ –≥—Ä—É–ø–ø –≤ –∫–∞–∂–¥–æ–º state)
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 8 –≥—Ä—É–ø–ø —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º —Å—Ç–∞—Ç—É—Å–æ–º
- –î–ª—è JOIN_QUEUED: retry_count –∏ next_retry_at
- –î–ª—è DISABLED: –∫–Ω–æ–ø–∫–∏ —Ä–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (DISABLED ‚Üí NEW)

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

‚úÖ **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ä–µ—Å—Ç–∞—Ä—Ç–∞–º** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î
‚úÖ **–ù–µ—Ç race conditions** ‚Äî –∞—Ç–æ–º–∞—Ä–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
‚úÖ **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å** ‚Äî —á—ë—Ç–∫–∞—è state machine
‚úÖ **–ú—è–≥–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** ‚Äî —Å—á—ë—Ç—á–∏–∫ consecutive_errors
‚úÖ **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã** ‚Äî —Ç–æ–ª—å–∫–æ Coordinator –º–µ–Ω—è–µ—Ç state
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –æ—Ç–ª–∞–¥–∫–∏** ‚Äî –∫–∞–∂–¥—ã–π state —è–≤–Ω—ã–π –∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

## –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—É—é –≥—Ä—É–ø–ø—É

1. –ê–¥–º–∏–Ω–∫–∞ ‚Üí ¬´üîí –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã¬ª ‚Üí ¬´‚ûï –î–æ–±–∞–≤–∏—Ç—å invite-—Å—Å—ã–ª–∫—É¬ª
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ invite-—Å—Å—ã–ª–∫—É
3. –ì—Ä—É–ø–ø–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (state=NEW)
4. Coordinator –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - –ù–∞–∑–Ω–∞—á–∞–µ—Ç –∞–∫–∫–∞—É–Ω—Ç (NEW ‚Üí ASSIGNED)
   - –°—Ç–∞–≤–∏—Ç –≤ –æ—á–µ—Ä–µ–¥—å (ASSIGNED ‚Üí JOIN_QUEUED)
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç join —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (JOIN_QUEUED ‚Üí JOINING ‚Üí JOINED)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø (JOINED ‚Üí ACTIVE)
5. –° –º–æ–º–µ–Ω—Ç–∞ ACTIVE —Å–∏—Å—Ç–µ–º–∞ —Å–ª—É—à–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

## –õ–æ–≥–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å–µ –∫–ª—é—á–µ–≤—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```
[Coordinator] Group 42 assigned to account_123456
[Coordinator] Group 42 queued for join
[Coordinator] Joining group 42 (https://t.me/+...)
[Coordinator] Successfully joined group 42: MyGroup (chat_id=-1001234567890)
[Coordinator] Group 42 is now ACTIVE
```

–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö:

```
[Coordinator] Error joining group 42: Invalid invite
[Coordinator] Lost access to group 42: Chat not found
```

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –≥—Ä—É–ø–ø–∞ —Å—Ç–∞–ª–∞ DISABLED

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `last_error` –≤ –∞–¥–º–∏–Ω–∫–µ
2. –ï—Å–ª–∏ invite-—Å—Å—ã–ª–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω–∞ ‚Äî –ø–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—É—é —É –≤–ª–∞–¥–µ–ª—å—Ü–∞ –≥—Ä—É–ø–ø—ã
3. –û–±–Ω–æ–≤–∏—Ç–µ invite_link –≤ –ë–î –≤—Ä—É—á–Ω—É—é (–∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ –∏ –¥–æ–±–∞–≤—å—Ç–µ –∑–∞–Ω–æ–≤–æ)
4. –ù–∞–∂–º–∏—Ç–µ ¬´‚ôªÔ∏è –†–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å¬ª –≤ –∞–¥–º–∏–Ω–∫–µ
5. Coordinator –∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–Ω–æ–≤–æ (DISABLED ‚Üí NEW ‚Üí ...)

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –±—ã–ª–∞ —Å—Ç–∞—Ä–∞—è –±–∞–∑–∞ —Å `status` –≤–º–µ—Å—Ç–æ `state`:

```bash
# –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—É—é –±–∞–∑—É (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
rm bot_database.db

# –ò–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é (–ø—Ä–æ–¥–∞–∫—à–µ–Ω)
sqlite3 bot_database.db "ALTER TABLE private_groups ADD COLUMN state TEXT DEFAULT 'NEW';"
sqlite3 bot_database.db "UPDATE private_groups SET state='ACTIVE' WHERE status='Joined' AND is_active=1;"
sqlite3 bot_database.db "UPDATE private_groups SET state='DISABLED' WHERE status='Inactive' OR is_active=0;"
```

–ó–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É ‚Äî Coordinator –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –≤—Å–µ –≥—Ä—É–ø–ø—ã –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –∏—Ö —Å—Ç–∞—Ç—É—Å.
